<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
  Substantial and accidental forms of a SQL expression

    </title>
    
    <link rel="stylesheet" href="/css/main.min.b0ac2a435097757bc0f52ca79b98b87531ff99fa1b4c88d169395513962577d9.css" /><meta property="og:title" content="Substantial and accidental forms of a SQL expression" />
<meta property="og:description" content="Multiplicity of parts, variety, and unity of plan which
combines the parts into a coherent whole, &ndash;
such are the elements of order found in all beauty.
(De Wulf 2012)
 I have been working with data intensive applications for a while and of course that means exposure to a lot of SQL, both personally and training other developers.
In these experiences I have noticed that it is sometimes harder than it should be to grasp what SQL is doing, specially since its accidental form makes understanding its substantial form so hard." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ebellani.github.io/blog/2024/substantial-and-accidental-forms-of-a-sql-expression/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2024-06-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-06-20T00:00:00+00:00" />

</head>
  <body><nav>
  <img
    src="/img/triquetra.png"
    alt="put your logo here"
    width="128"
    height="128"
  />
  <h1>Eduardo&#39;s blog</h1>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/blog">Blog</a></li>
  </ul>
</nav>
<main>
  <h2>Substantial and accidental forms of a SQL expression
    <small>
      <time>June 20, 2024</time>
    by Eduardo Bellani


    </small>
  </h2><div class="verse">
<p>Multiplicity of parts, variety, and unity of plan which<br />
combines the parts into a coherent whole, &ndash;<br />
such are the elements of order found in all beauty.<br />
(<a href="#citeproc_bib_item_2">De Wulf 2012</a>)<br /></p>
</div>
<p>I have been working with data intensive applications for a while and of
course that means exposure to a lot of SQL, both personally and training
other developers.</p>
<p>In these experiences I have noticed that it is sometimes harder than it
should be to grasp what SQL is doing, specially since its accidental
form makes understanding its substantial form so hard. In this post I&rsquo;m
going to try to help the reader separate the two and understand SQL
better.</p>
<p>But first, some definitions of terms:</p>
<blockquote>
<p>&hellip; <strong>form</strong> is the principle of organization of a thing’s matter, or the
thing’s intelligible nature, form can be of two kinds.</p>
<p>&hellip; (it) can be <strong>substantial</strong>, organizing the matter into the
kind of thing that the substance is.</p>
<p>On the other hand, form can be <strong>accidental</strong>, organising some part of an
already constituted substance.</p>
<ul>
<li>
<p><strong>substantial form</strong> always &hellip; brings a new substance into existence;</p>
</li>
<li>
<p>accidental form simply informs an already existing substance, and in
doing so it simply modifies some substance. (<a href="#citeproc_bib_item_3">Kerrl, n.d.</a>)</p>
</li>
</ul>
</blockquote>
<p>One of the core problems with SQL and in particular its <code>SELECT</code>
expression is that the way it is written/read (and the usual
expectations of the terms such as <code>SELECT/FROM</code> &hellip;) is very different
from what is actually taking place.</p>
<p>Let&rsquo;s discuss this fact starting from an example (the example and much
of the discussion are taken from (<a href="#citeproc_bib_item_1">Date and Darwen 1997</a>))</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="w">  </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P</span><span class="p">.</span><span class="n">PNO</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Weight in grams =&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TEXT1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P</span><span class="p">.</span><span class="n">WEIGHT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">454</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">GMWT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P</span><span class="p">.</span><span class="n">COLOR</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Max Quantity =&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TEXT2</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="n">SQ</span><span class="p">.</span><span class="n">QTY</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MQTY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">SP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">WHERE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P</span><span class="p">.</span><span class="n">PNO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SP</span><span class="p">.</span><span class="n">PNO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Red&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">P</span><span class="p">.</span><span class="n">COLOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Blue&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">SP</span><span class="p">.</span><span class="n">QTY</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P</span><span class="p">.</span><span class="n">PNO</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P</span><span class="p">.</span><span class="n">WEIGHT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P</span><span class="p">.</span><span class="n">COLOR</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">HAVING</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">SP</span><span class="p">.</span><span class="n">QTY</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">350</span><span class="w">
</span></span></span></code></pre></div><p>The difficulty here starts right at the begging, since the <code>SELECT</code>
clause is the first to be read and written, but it is the <strong>last</strong> to be
evaluated. Here is how to interpret this <code>SELECT</code> expression:</p>
<ol>
<li>
<p><strong>FROM</strong> <span class="org-target" id="org-target--join"></span>: The source of the data. An usually overseen point is
that the <code>FROM</code> clause is actually a <code>JOIN</code> (a <code>CROSS JOIN</code>
specifically).</p>
</li>
<li>
<p><strong>WHERE</strong> <span class="org-target" id="org-target--restriction"></span>: The result of the <code>JOIN</code> of the
<a href="#org-target--join">previous step</a> is reduced by elimination of rows (a process
called <code>RESTRICTION</code> in the Relational Algebra).</p>
</li>
<li>
<p><strong>GROUP BY</strong> <span class="org-target" id="org-target--dictionary"></span>: This is one of the most complex parts of
the expression because it goes outside the Relational Algebra. You
can think of it as creating, from the <a href="#org-target--restriction">restricted table</a>, a Dictionary
where the keys are a combination of the values of the defined columns
and the referenced values are all the rows where the keys exist.</p>
<p><strong>NOTE HOWEVER</strong> that such Dictionary is <strong>NOT</strong> a proper table. And that is why a
<code>GROUP BY</code> clause will always demand a corresponding <code>SELECT</code> clause
that turns such Dictionary into a proper table.</p>
</li>
<li>
<p><strong>HAVING</strong> <span class="org-target" id="org-target--filter"></span>: This clause applies to the <a href="#org-target--dictionary">Dictionary values
generated by GROUP BY</a>, filtering all rows that do not match the
condition. This is another operator that sits outside the Relational
Algebra.</p>
</li>
<li>
<p><strong>SELECT</strong> : This is called a <code>PROJECTION</code> in Relational Algebra. It is
where you pick the colums of the table. It is also where each group
resulting from the <a href="#org-target--filter">HAVING filter</a> should now generate a single result
row, by this process:</p>
<ol>
<li>The part number, weight, color and maximum quantity are extracted from the Dictionary</li>
<li>The weight is converted to grams</li>
<li>Two literals are added (&lsquo;Weight in grams =&rsquo;, &lsquo;Max Quantity =&rsquo;).</li>
<li>All these insertions are ordered. The result looks like this:</li>
</ol>
</li>
</ol>
<table>
<thead>
<tr>
<th>PNO</th>
<th>TEXT1</th>
<th>GMWT</th>
<th>COLOR</th>
<th>TEXT2</th>
<th>MQTY</th>
</tr>
</thead>
<tbody>
<tr>
<td>P1</td>
<td>Weight in grams =</td>
<td>5448</td>
<td>Red</td>
<td>Max Quantity =</td>
<td>300</td>
</tr>
<tr>
<td>P5</td>
<td>Weight in grams =</td>
<td>5448</td>
<td>Blue</td>
<td>Max Quantity =</td>
<td>400</td>
</tr>
</tbody>
</table>
<h2 id="so-what">So what</h2>
<p>I hope the reader will leave with a better appreciation of what a SQL
<code>SELECT</code> expression actually is, instead of what it looks like. I also
think that understanding the concept of substantial vs accidental form
can help the reader a lot in understanding things like such expression
in the future.</p>
<p>I also think a point that deserves attention is how worse the <code>SELECT</code>
expression becomes by SQL&rsquo;s introduction of operators that don&rsquo;t fit the
relational algebra (<code>GROUP BY</code> and <code>HAVING</code> clauses). Besides such, the
<code>SELECT</code> expression is merely a <code>JOIN-&gt;RESTRICT-&gt;PROJECT</code> sequence.</p>
<figure><img src="/ox-hugo/st-maria-civil-war--comparision-2.jpg"
         alt="Figure 1: Santa Maria del Mar destroyed by communist arson, circa 1936"/><figcaption>
            <p><span class="figure-number">Figure 1: </span>Santa Maria del Mar destroyed by communist arson, circa 1936</p>
        </figcaption>
</figure>

<h2 id="references">References</h2>
<style>.csl-entry{text-indent: -1.5em; margin-left: 1.5em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>Date, C. J., and Hugh Darwen. 1997. <i>A Guide to the Sql Standard (4th Ed.): A User’s Guide to the Standard Database Language Sql</i>. USA: Addison-Wesley Longman Publishing Co., Inc.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>De Wulf, M. 2012. <i>The System of Thomas Aquinas</i>. Verlag Editiones Scholasticae.</div>
  <div class="csl-entry"><a id="citeproc_bib_item_3"></a>Kerrl, Gaven. n.d. “Aquinas: Metaphysics.” The Internet Encyclopedia of Philosophy. <a href="https://web.archive.org/web/20240313230721/https://iep.utm.edu/thomas-aquinas-metaphysics/">https://web.archive.org/web/20240313230721/https://iep.utm.edu/thomas-aquinas-metaphysics/</a>.</div>
</div>


   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   

   





<footer>
  <p>Feel free to send me an email: ebellani -at- gmail -dot- com</p>
  <p>
    PGP Key Fingerprint: 48C50C6F1139C5160AA0DC2BC54D00BC4DF7CA7C
  </p>
</footer>

      </main>
    </main>
  </body>
</html>
